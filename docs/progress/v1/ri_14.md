# Issue #28 구현 계획서

**날짜**: 2025-10-20
**이슈**: [Release] v1.5.0 - Phase 4 완성 및 승인 워크플로우 릴리스 준비
**작성자**: Claude Code
**상태**: 계획 수립 완료

---

## 📋 Issue Analysis & Solution Planning

### Issue Information Summary

**이슈 번호**: #28
**제목**: [Release] v1.5.0 - Phase 4 완성 및 승인 워크플로우 릴리스 준비
**상태**: OPEN
**생성일**: 2025-10-20T05:29:46Z
**담당자**: 없음
**라벨**: 없음
**마일스톤**: 없음

**문제 유형**: Release Management
**우선순위**: High
**복잡도**: Medium

---

## 핵심 요구사항

### **배경**
Issue #26 (보안 승인 워크플로우 사용자 경험 완성)이 PR #27을 통해 머지 완료되었습니다. Phase 4 완성 및 v1.5.0 릴리스를 준비해야 합니다.

### **주요 구현 사항 (Issue #26, PR #27)**
1. ✅ **CLI UX 통합** (`scripts/ai.py` +160줄)
   - Rich 기반 진행률 바 및 폴백 메커니즘
   - 403 응답 감지 및 승인 대기 상태 시각화
   - 자동 재시도 및 성공/거부 메시지 출력

2. ✅ **보안 관리자 API** (`services/mcp-server/security_admin.py` +260줄)
   - GET `/api/approvals/pending`: 필터/페이징 지원
   - POST `/api/approvals/{id}/approve`: 멱등성, 409 중복 처리
   - POST `/api/approvals/{id}/reject`: 멱등성
   - GET `/api/approvals/{id}/status`: 실시간 캐싱 없음

3. ✅ **CI/CD 통합** (`.github/workflows/ci.yml` +63줄)
   - approval-tests job 추가
   - pytest, aiosqlite, rich 의존성 설치
   - test_approval_workflow.py 실행
   - 커버리지 보고서 생성

4. ✅ **성능 벤치마크** (Phase 5)
   - SQLite WAL 모드 60초 / 50 RPS 테스트 통과
   - 총 3,000건 요청, 성공률 100%, P95 397ms
   - 산출물: `docs/benchmarks/approval_workflow_phase5.md`, `data/approval_benchmark.csv`

5. ✅ **운영 정책 문서** (`docs/security/APPROVAL_POLICY.md` ~400줄)
   - 환경별 feature flag 설정 (Dev/Staging/Production)
   - 배포 절차 및 롤백 방법
   - 운영 권장치 업데이트

### **해결 목표 (Issue #28)**
1. ✅ **Phase 0**: 승인 UX 사전 조건 검증 (미들웨어 403 응답, CLI UX)
2. ⏳ **Phase 1**: 전체 테스트 실행 및 회귀 검증 (144개 Python + 22개 E2E)
3. ⏳ **Phase 2**: CHANGELOG.md 작성 및 문서 동기화
4. ⏳ **Phase 3**: Git 태그 및 GitHub Release 생성

---

## Technical Investigation

### 코드베이스 현황 분석

#### ✅ **완료된 Issue #26 구현**

1. **CLI Integration** (`scripts/ai.py`)
   - 라인 178-323: 승인 워크플로우 처리 로직 완료
   - `handle_approval_workflow()`: Rich 기반 진행률 바 (214-280줄)
   - `wait_for_approval_simple()`: 폴백 메커니즘 (282-323줄)
   - 환경 변수: `APPROVAL_TIMEOUT`, `APPROVAL_POLLING_INTERVAL`

2. **Middleware** (`services/mcp-server/rbac_middleware.py`)
   - 라인 71-122: 승인 워크플로우 자동 통합 완료
   - 403 응답 구조: `approval_required`, `request_id`, `detail` 포함
   - Request body 복원 로직 (85-88줄)

3. **Dependencies** (`scripts/requirements.txt`)
   - Rich >= 13.0.0 추가 완료
   - Requests >= 2.28.0 유지

4. **Test Coverage**
   - **총 144개 Python 테스트** (scripts/count_tests.py 기준)
     - RAG: 49 tests
     - Embedding: 18 tests
     - API Gateway: 15 tests
     - MCP Server: 47 tests (승인 워크플로우 8개 포함)
     - Memory: 7 tests
     - Other: 8 tests
   - **총 22개 E2E 테스트** (Playwright, 구현 완료 상태)

5. **Performance Benchmarks**
   - SQLite WAL 모드: 50 RPS, P95 397ms, 성공률 100%
   - 산출물: `docs/benchmarks/approval_workflow_phase5.md`

#### 📋 **릴리스 준비 상태**

**완료된 작업**:
- ✅ Issue #26 구현 완료 및 PR #27 머지
- ✅ 승인 워크플로우 CLI/API 통합
- ✅ CI/CD 자동 검증 파이프라인
- ✅ 성능 벤치마크 실행 및 문서화
- ✅ 운영 정책 문서화

**필요한 작업**:
- ⏳ Phase 0: 승인 UX 사전 조건 재검증 (회귀 방지)
- ⏳ Phase 1: 전체 테스트 실행 (pytest -q 144개)
- ⏳ Phase 2: CHANGELOG.md 작성
- ⏳ Phase 3: v1.5.0 릴리스 (Git 태그 + GitHub Release)

---

### 문서 정합성 이슈 및 해결책 (Phase 1 영향)

최근 리뷰에서 `docs/progress/v1/ri_1.md` 문서가 현재 코드베이스와 불일치한다는 사실을 확인했습니다. Phase 1 레퍼런스 문서는 Phase 4 릴리스에도 지속 활용되므로, 다음 보완 작업을 Issue #28 범위에 포함합니다.

- **`docs/progress/v1/ri_1.md:3` – 잘못된 명령 안내**
  - 문제: 존재하지 않는 `resolve-issue 1` CLI 호출을 안내하고 있습니다.
  - 해결책: 해당 문구를 삭제하고, 승인 워크플로우 시나리오에 맞춰 `scripts/ai.py` 또는 `scripts/approval_cli.py` 사용 예시로 대체합니다. 예) `python scripts/ai.py --mcp approvals:list`.

- **`docs/progress/v1/ri_1.md:119` – 이미 존재하는 디렉터리 재생성 지시**
  - 문제: `docker/`, `services/api-gateway/` 디렉터리를 새로 만들라고 안내하지만 저장소에 이미 존재합니다.
  - 해결책: 디렉터리 생성 단계는 삭제하고, 필요 시 해당 경로에서 파일을 검토·수정하는 절차로 교체합니다. 예) “`services/api-gateway/config.p1.yaml` 내용을 확인 후 Phase 1 설정값과 일치하도록 조정”.

- **`docs/progress/v1/ri_1.md:253` – Compose 예시와 실 구현 불일치**
  - 문제: 문서 상 샘플 Compose가 실제 `docker/compose.p1.yml`과 상충하며, 상대 경로(`../services/...`) 때문에 루트에서 `docker compose` 실행 시 실패합니다.
  - 해결책: 문서의 Compose 예시는 삭제하거나 “기존 `docker/compose.p1.yml`을 기준으로 GPU/모델 파라미터를 조정” 단계로 교체합니다. 필요 시 수정 포인트를 표 형태(예: `CHAT_GGUF → CHAT_MODEL`)로 명시합니다.

- **`docs/progress/v1/ri_1.md:69` – 존재하는 파일을 Missing Files로 표기**
  - 문제: `docker/compose.p1.yml`, `services/api-gateway/config.p1.yaml`이 존재하는데도 미존재로 서술되어 있습니다.
  - 해결책: “필수 파일 목록” 섹션으로 바꾸고, 실제 경로와 검토 포인트(포트, 모델 경로, GPU 설정 등)를 나열합니다.

> **Action Item**: Phase 2 문서 작업 시 `docs/progress/v1/ri_1.md`를 위 지침대로 정리하고 PR에 포함합니다. 릴리스 노트에도 “Phase 1 계획 문서 정합성 보정” 항목을 추가합니다.

**다음 단계**
- `docs/progress/v1/ri_1.md`를 현재 코드베이스 기준으로 보정하고, 확인 체크리스트를 업데이트한다.
- CHANGELOG에 “Phase 1 계획 문서 정합성 보정” 항목을 추가해 릴리스 메모와 동기화한다.

---

## Solution Strategy

### Approach: 단계적 릴리스 준비 (4 Phases)

**선택 근거**:
- Issue #26 구현이 완료되어 추가 코드 작업 불필요
- 테스트 실행 및 문서화에 집중
- 안정적인 릴리스를 위한 회귀 검증 필수
- CLAUDE.md, README.md 등 문서 동기화 중요

**예상 시간**: 3-4시간
**위험도**: Low (코드 변경 없음, 검증 중심)

**장점**:
- ✅ 코드 동결 상태에서 안전한 릴리스
- ✅ 전체 테스트 실행으로 회귀 방지
- ✅ CHANGELOG로 변경사항 추적 가능
- ✅ GitHub Release로 공식 릴리스 관리

**단점**:
- ⚠️ 문서 작업에 1-2시간 소요
- ⚠️ 테스트 실행 시간 (144개 테스트)

---

## Detailed Implementation Plan

### Phase 0: 승인 UX 사전 조건 검증 (30분)

**목표**: Issue #26 구현 상태 최종 확인 및 회귀 방지

| Task | Description | DoD | Risk |
|------|-------------|-----|------|
| 미들웨어 403 응답 구조 확인 | `rbac_middleware.py` 71-122줄 검증 | `approval_required`, `request_id` 포함 확인 | Low |
| CLI UX Rich 기반 확인 | `scripts/ai.py` 214-280줄 검증 | `handle_approval_workflow()` 정상 동작 | Low |
| CLI 폴백 메커니즘 확인 | `scripts/ai.py` 282-323줄 검증 | `wait_for_approval_simple()` 정상 동작 | Low |
| 의존성 확인 | `scripts/requirements.txt` 검증 | `rich>=13.0.0` 포함 확인 | Low |

**검증 명령**:
```bash
# 코드 검증
grep -n "approval_required" services/mcp-server/rbac_middleware.py
grep -n "handle_approval_workflow" scripts/ai.py
grep -n "rich" scripts/requirements.txt

# 승인 워크플로우 통합 테스트 (8개)
pytest services/mcp-server/tests/test_approval_workflow.py -v
```

---

### Phase 1: 전체 테스트 실행 및 회귀 검증 (60-90분)

**목표**: 144개 Python 테스트 실행 및 0 failures 확인

| Task | Description | DoD | Risk |
|------|-------------|-----|------|
| Python 단위 테스트 실행 | pytest -q 실행 (144개) | 0 failed 확인 | Medium |
| 승인 워크플로우 테스트 | test_approval_workflow.py (8개) | 100% 통과 | Low |
| RBAC 통합 테스트 | test_rbac_integration.py (10개) | 100% 통과 | Low |
| API Gateway 헬스체크 | curl localhost:8000/health | HTTP 200 응답 | Low |
| RAG 서비스 헬스체크 | curl localhost:8002/health | HTTP 200 응답 | Low |
| MCP 서버 헬스체크 | curl localhost:8020/health | HTTP 200 응답 | Low |
| 승인 CLI 수동 테스트 | scripts/approval_cli.py 실행 | 대화형 TUI 정상 동작 | Low |

**테스트 명령**:
```bash
# 전체 Python 테스트 (144개)
pytest -q 2>&1 | tee /tmp/pytest_results.txt

# 서비스 헬스체크 (Phase 3 스택 가동 필요)
docker compose -f docker/compose.p3.yml up -d
curl -f http://localhost:8000/health  # API Gateway
curl -f http://localhost:8002/health  # RAG
curl -f http://localhost:8020/health  # MCP Server

# 승인 워크플로우 수동 테스트
# Terminal 1: 승인 관리자 CLI
python3 services/mcp-server/scripts/approval_cli.py

# Terminal 2: 사용자 요청 (HIGH 도구)
ai --mcp execute_bash --mcp-args '{"command": "ls", "working_dir": "/tmp"}'
```

**예상 결과**:
- ✅ pytest: 144 passed, 0 failed
- ✅ 모든 헬스체크 HTTP 200
- ✅ 승인 CLI: Rich TUI 정상 표시
- ✅ 사용자 CLI: 진행률 바 + 자동 재시도 동작

---

### Phase 2: 문서 정합성 보정 및 CHANGELOG.md 작성 (75분) ⭐ **우선순위 최고**

**목표**:
1. **[우선] Phase 1 문서 정합성 보정** (`docs/progress/v1/ri_1.md`)
2. v1.5.0 CHANGELOG.md 작성
3. 프로젝트 문서 동기화 (CLAUDE.md, README.md)

**작업 순서**:

#### Phase 2-1: ri_1.md 정합성 보정 (25분) ⭐ **먼저 실행**

| Task | Description | DoD | Risk |
|------|-------------|-----|------|
| ri_1.md:3 수정 | `resolve-issue 1` 안내 제거 → `scripts/ai.py` 사용 예시로 대체 | 존재하지 않는 CLI 호출 제거 | Low |
| ri_1.md:69 수정 | Missing Files → "필수 파일 목록"으로 변경 | `docker/compose.p1.yml`, `services/api-gateway/config.p1.yaml` 경로/검토 포인트 명시 | Low |
| ri_1.md:119 수정 | 디렉터리 생성 지시 제거 → 파일 검토·수정 절차로 교체 | "내용을 확인 후 Phase 1 설정값과 일치하도록 조정" 표현 | Low |
| ri_1.md:253 수정 | Compose 예시 삭제 → "기존 docker/compose.p1.yml을 기준으로 조정" 단계로 교체 | 파라미터 수정 테이블(예: `CHAT_GGUF → CHAT_MODEL`) 명시 | Low |

**검증 명령**:
```bash
# ri_1.md 확인
grep -n "resolve-issue 1" docs/progress/v1/ri_1.md  # 없어야 함
grep -n "scripts/ai.py\|scripts/approval_cli.py" docs/progress/v1/ri_1.md  # 추가되어야 함
```

#### Phase 2-2: CHANGELOG.md 작성 (35분)

| Task | Description | DoD | Risk |
|------|-------------|-----|------|
| CHANGELOG.md 생성 | v1.5.0 섹션 추가 | 주요 변경사항 5개 이상 작성 | Low |
| Issue #26 완료 기록 | 승인 워크플로우 UX 통합 내용 | CLI/API/CI/벤치마크 포함 | Low |
| 테스트 수량 기록 | 144개 Python + 22개 E2E | 정확한 수량 명시 | Low |
| Breaking Changes 확인 | 호환성 검토 | 없으면 "None" 명시 | Low |
| 신규 의존성 기록 | Rich library 추가 | scripts/requirements.txt 반영 | Low |
| **ri_1.md 정합성 보정 항목 추가** | Phase 1 문서 정합성 개선 기록 | "Documentation: Fixed Phase 1 planning document inconsistencies" 추가 | Low |

#### Phase 2-3: 프로젝트 문서 동기화 (15분)

| Task | Description | DoD | Risk |
|------|-------------|-----|------|
| CLAUDE.md 업데이트 | Production readiness 100% 반영 | Issue #26 완료 상태 반영 | Low |
| README.md 동기화 | 필요 시 업데이트 | CLAUDE.md와 일관성 유지 | Low |

**CHANGELOG.md 구조**:
```markdown
# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [1.5.0] - 2025-10-20

### Added
- **Approval Workflow UX**: Rich-based progress bar for HIGH/CRITICAL tool approval waiting (Issue #26)
- **Security Admin API**: 4 REST endpoints for approval management (pending, approve, reject, status)
- **CI/CD Integration**: Automated approval workflow tests in GitHub Actions
- **Performance Benchmarking**: SQLite WAL mode tested at 50 RPS, P95 397ms, 100% success rate
- **Operational Policy**: APPROVAL_POLICY.md with environment-specific feature flag guide

### Changed
- **CLI Experience**: `scripts/ai.py` now shows real-time approval progress with 1s polling interval
- **Middleware**: `rbac_middleware.py` returns 403 with `approval_required` field for HIGH/CRITICAL tools
- **Dependencies**: Added `rich>=13.0.0` to `scripts/requirements.txt` for terminal UI

### Fixed
- **Approval Timeout Handling**: Graceful degradation to simple progress when Rich unavailable
- **Request Body Restoration**: Fixed middleware body consumption issue for approval flow

### Performance
- **SQLite Approval Workflow**: Achieved 50 RPS (5x target), P95 397ms (20% better than 500ms goal)

### Testing
- **Total Tests**: 144 Python tests + 22 E2E Playwright tests
- **Approval Tests**: 8 new integration tests (granted, rejected, timeout, concurrent, etc.)

### Documentation
- `docs/security/APPROVAL_POLICY.md`: Feature flag policy for Dev/Staging/Production
- `docs/benchmarks/approval_workflow_phase5.md`: Performance benchmark results
- `docs/progress/v1/ri_13.md`: Issue #26 detailed implementation plan
- **`docs/progress/v1/ri_1.md` (Fixed)**: Phase 1 planning document updated for code consistency

### Fixed (Documentation)
- **Phase 1 Document Consistency**: Corrected outdated CLI references, removed non-existent directory creation steps, replaced Compose examples with actual implementation guidance

### Breaking Changes
None

### Dependencies
- Added: `rich>=13.0.0` (terminal UI for approval progress)

---

## [1.4.0] - 2025-10-17
... (previous releases)
```

**문서 업데이트 체크리스트**:
- [ ] CHANGELOG.md 생성 및 v1.5.0 섹션 작성
- [ ] CLAUDE.md 업데이트 (Issue #26 완료 상태 반영)
- [ ] README.md 동기화 확인 (필요 시)
- [ ] docs/security/APPROVAL_POLICY.md 링크 확인
- [ ] docs/benchmarks/approval_workflow_phase5.md 링크 확인

---

### Phase 3: Git 태그 및 GitHub Release 생성 (30-60분)

**목표**: v1.5.0 공식 릴리스 및 Release Notes 작성

| Task | Description | DoD | Risk |
|------|-------------|-----|------|
| 버전 번호 결정 | v1.5.0 (Feature Release) | Semantic Versioning 준수 | Low |
| Git annotated tag 생성 | `git tag -a v1.5.0 -m "..."` | 태그 생성 완료 | Low |
| Git tag push | `git push origin v1.5.0` | 원격 태그 생성 | Low |
| GitHub Release Notes 작성 | CHANGELOG.md 기반 작성 | Release 페이지 완성 | Medium |
| Release 바이너리 확인 | 필요 시 첨부 | 없으면 스킵 | Low |

**Git 태그 명령**:
```bash
# Annotated tag 생성
git tag -a v1.5.0 -m "Release v1.5.0 - Approval Workflow UX Integration

- Issue #26: Approval workflow UX complete
- CLI: Rich-based progress bar for approval waiting
- API: 4 approval management endpoints
- CI/CD: Automated approval tests
- Performance: 50 RPS, P95 397ms, 100% success
- Docs: APPROVAL_POLICY.md operational guide

Total: 144 Python tests + 22 E2E tests"

# Tag 확인
git tag -l -n9 v1.5.0

# Remote push
git push origin v1.5.0
```

**GitHub Release Notes 구조**:
```markdown
# Release v1.5.0 - Approval Workflow UX Integration

**Release Date**: 2025-10-20
**Type**: Feature Release
**Related Issues**: #26, #28

---

## 🎉 Highlights

This release completes the **Approval Workflow UX Integration** (Issue #26), enabling production-ready security controls for HIGH/CRITICAL MCP tools.

### Key Features

1. **✨ Rich Terminal UI for Approval Waiting**
   - Real-time progress bar with 1-second polling
   - Automatic retry after approval granted
   - Graceful fallback for environments without Rich library

2. **🔧 Security Admin API**
   - `GET /api/approvals/pending`: List pending approvals with filters
   - `POST /api/approvals/{id}/approve`: Approve requests (idempotent)
   - `POST /api/approvals/{id}/reject`: Reject requests (idempotent)
   - `GET /api/approvals/{id}/status`: Check approval status

3. **🚀 CI/CD Integration**
   - Automated approval workflow tests in GitHub Actions
   - 8 new integration tests (approval scenarios)

4. **📊 Performance Benchmarking**
   - SQLite WAL mode: **50 RPS** (5x target)
   - P95 latency: **397ms** (20% better than 500ms goal)
   - Success rate: **100%** (3,000 requests)

5. **📚 Operational Documentation**
   - `APPROVAL_POLICY.md`: Feature flag guide (Dev/Staging/Prod)
   - Performance benchmark results

---

## 📦 What's Changed

### Added
- CLI approval progress UI with Rich library (#26)
- Security Admin API (4 endpoints) (#26)
- CI/CD approval tests integration (#26)
- SQLite performance benchmark (#26)
- APPROVAL_POLICY.md operational guide (#26)

### Changed
- `scripts/ai.py`: Real-time approval waiting UX (+160 lines)
- `rbac_middleware.py`: 403 response with `approval_required` field
- `requirements.txt`: Added `rich>=13.0.0`

### Fixed
- Approval timeout graceful handling
- Request body restoration in middleware

---

## 🧪 Testing

- **Total Tests**: 144 Python tests + 22 E2E Playwright tests
- **New Tests**: 8 approval workflow integration tests
- **Test Results**: 100% pass rate

---

## 📖 Documentation

- [APPROVAL_POLICY.md](docs/security/APPROVAL_POLICY.md): Operational policy
- [Benchmark Results](docs/benchmarks/approval_workflow_phase5.md): Performance data
- [Implementation Plan](docs/progress/v1/ri_13.md): Issue #26 details

---

## 🔧 Installation & Upgrade

### New Installation
```bash
git clone https://github.com/sunbangamen/local-ai-suite.git
cd local-ai-suite
git checkout v1.5.0
./install.sh
```

### Upgrade from v1.4.x
```bash
git pull origin main
git checkout v1.5.0
pip install -r scripts/requirements.txt  # Install Rich
docker compose -f docker/compose.p3.yml up -d --build
```

---

## ⚙️ Configuration

Enable approval workflow in production:

```bash
# .env
APPROVAL_WORKFLOW_ENABLED=true
RBAC_ENABLED=true
APPROVAL_TIMEOUT=600  # 10 minutes
APPROVAL_POLLING_INTERVAL=1  # 1 second
```

See [APPROVAL_POLICY.md](docs/security/APPROVAL_POLICY.md) for details.

---

## 🐛 Known Issues

None

---

## 🙏 Contributors

- @sunbangamen (Implementation & Testing)
- Claude Code (Code Review & Documentation)

---

**Full Changelog**: https://github.com/sunbangamen/local-ai-suite/compare/v1.4.0...v1.5.0
```

**GitHub Release 생성 명령**:
```bash
# gh CLI 사용
gh release create v1.5.0 \
  --title "Release v1.5.0 - Approval Workflow UX Integration" \
  --notes-file /tmp/release_notes.md \
  --draft  # 검토 후 공개

# Release 확인
gh release view v1.5.0

# Draft → Published 전환
gh release edit v1.5.0 --draft=false
```

---

## Risk Assessment & Mitigation

### High Risk Items

| Risk | Impact | Probability | Mitigation Strategy |
|------|--------|-------------|-------------------|
| 테스트 실패 발견 | High | Low | Phase 1에서 조기 발견, 수정 후 재실행 |
| 문서 누락/오류 | Medium | Medium | Phase 2에서 체크리스트 기반 검증 |
| Git 태그 충돌 | Low | Low | 태그 생성 전 `git tag -l` 확인 |

### Technical Challenges

**예상 기술적 난점**:
1. **테스트 실행 시간** - 144개 테스트 실행에 30-60분 소요 가능
   - **해결 방안**: pytest -x (첫 실패 시 중단), 병렬 실행 검토
2. **Phase 3 스택 가동** - Docker Compose 전체 스택 필요
   - **해결 방안**: `make up-p3` 명령으로 간편 가동
3. **CHANGELOG 작성 복잡도** - 변경사항 추적 어려움
   - **해결 방안**: Issue #26 문서(`ri_13.md`) 참조, PR #27 diff 확인

### Rollback Plan

**롤백 시나리오**:
- **태그 생성 오류** → `git tag -d v1.5.0 && git push origin :refs/tags/v1.5.0`
- **Release Notes 오류** → `gh release edit v1.5.0` 수정
- **테스트 실패** → 수정 후 재실행, 필요 시 릴리스 연기

---

## Resource Requirements

### Human Resources
- **개발자**: 1명 (릴리스 담당자)
- **리뷰어**: 1명 (선택적, CHANGELOG 검토)
- **QA**: 없음 (자동화된 테스트)

### Technical Resources
- **개발 도구**: git, gh CLI, pytest, docker-compose
- **테스트 환경**: Phase 3 Docker stack (localhost:8000-8020)
- **모니터링**: pytest 출력, curl 헬스체크

### Time Estimation
- **Phase 0**: 30분 (사전 조건 검증)
- **Phase 1**: 60-90분 (테스트 실행)
- **Phase 2**: 60분 (CHANGELOG 작성)
- **Phase 3**: 30-60분 (Git 태그/Release)
- **총 예상 시간**: 3-4시간
- **버퍼 시간**: 1시간 (예상의 25%)
- **완료 목표일**: 2025-10-20 (당일)

---

## Quality Assurance Plan

### Test Strategy

**테스트 레벨**:
- **Unit Tests**: 144개 Python 테스트 (pytest)
- **Integration Tests**: 승인 워크플로우 8개, RBAC 10개
- **E2E Tests**: 22개 Playwright 테스트 (선택적)
- **Manual Tests**: 승인 CLI 대화형 테스트

### Test Cases

```gherkin
Feature: Approval Workflow UX Integration (Issue #26)

  Scenario: 사용자가 HIGH 등급 도구 실행 시 승인 대기
    Given MCP 서버가 APPROVAL_WORKFLOW_ENABLED=true로 가동 중
    When 사용자가 `ai --mcp execute_bash --mcp-args '{"command": "ls"}'` 실행
    Then CLI에 Rich 진행률 바 표시
    And 1초 간격으로 승인 상태 폴링
    And 관리자 승인 후 자동으로 도구 실행 완료

  Scenario: 승인 관리자가 대기 목록 조회
    Given 승인 대기 요청 3건 존재
    When 관리자가 `python3 scripts/approval_cli.py` 실행
    Then Rich TUI에 3건 목록 표시
    And Short ID, 사용자, 도구명, 만료 카운트다운 표시

  Scenario: pytest 전체 테스트 실행
    Given Phase 3 스택 가동 완료
    When `pytest -q` 실행
    Then 144 passed, 0 failed 확인
    And 승인 워크플로우 테스트 8개 포함
```

### Performance Criteria

**이미 달성된 성능 기준** (Phase 5 벤치마크):
- ✅ **처리량**: 50 RPS (목표 10 RPS의 5배)
- ✅ **레이턴시**: P95 397ms (목표 500ms 대비 20% 개선)
- ✅ **안정성**: 성공률 100% (목표 99% 초과)

---

## Communication Plan

### Status Updates
- **이슈 댓글 업데이트**: 각 Phase 완료 시 체크박스 업데이트
- **커밋 메시지**: 각 Phase 작업 완료 후 커밋 (체크리스트 반영)

### Stakeholder Notification
- **프로젝트 관리자**: GitHub Release 생성 후 알림
- **사용자**: Release Notes를 통한 변경사항 공유

---

## 📋 Acceptance Criteria (DoD)

### Phase 0: 승인 UX 사전 조건 검증
- [x] `rbac_middleware.py`가 승인 대기 시 즉시 403 반환 (Issue #26 완료)
- [x] 403 응답 JSON에 `approval_required`, `request_id`, `detail` 포함 (Issue #26 완료)
- [x] `scripts/ai.py` 진행률/타임아웃 UX 정상 동작 (Rich 기반) (Issue #26 완료)
- [x] 승인 완료 시 자동 재시도 및 성공/거부 메시지 확인 (Issue #26 완료)
- [x] 기존 승인 관련 단위/통합 테스트 회귀 없음 (Issue #26 완료)

### Phase 1: 테스트 실행 및 회귀 검증
- [ ] `pytest -q` 실행 결과 0 failed
- [ ] API Gateway 헬스체크 통과 (HTTP 200)
- [ ] RAG 서비스 헬스체크 통과 (HTTP 200)
- [ ] MCP 서버 헬스체크 통과 (HTTP 200)
- [ ] 승인 워크플로우 CLI 수동 테스트 통과
- [ ] 이전 기능 회귀 없음 확인

### Phase 2: 문서화 및 CHANGELOG 업데이트
- [ ] CHANGELOG.md에 Issue #26 완료 내용 추가
- [ ] 테스트 통과 수량 기록 (144개 Python + 22개 E2E)
- [ ] 주요 변경사항 5가지 이상 작성
- [ ] Breaking Changes 섹션 확인 (없으면 명시)
- [ ] 신규 의존성 기록 (Rich library)
- [ ] CLAUDE.md 업데이트 (Issue #26 완료 반영)
- [ ] README.md 동기화 확인

### Phase 3: 릴리스 준비
- [ ] 버전 번호 결정 (v1.5.0)
- [ ] Git annotated tag 생성 (`git tag -a v1.5.0`)
- [ ] Git tag push (`git push origin v1.5.0`)
- [ ] GitHub Release Notes 작성 (CHANGELOG 기반)
- [ ] GitHub Release 생성 (Draft → Published)

---

## 🚀 Next Steps

### 🎯 작업 순서 (우선순위 명시)

#### **STEP 1: Phase 0 실행** (30분)
```bash
# 코드 검증
grep -n "approval_required" services/mcp-server/rbac_middleware.py
grep -n "handle_approval_workflow" scripts/ai.py

# 승인 테스트 실행
pytest services/mcp-server/tests/test_approval_workflow.py -v
```

#### **STEP 2: Phase 1 실행** (60-90분)
```bash
# Phase 3 스택 가동
docker compose -f docker/compose.p3.yml up -d

# 전체 테스트
pytest -q

# 헬스체크
curl -f http://localhost:8000/health
curl -f http://localhost:8002/health
curl -f http://localhost:8020/health
```

#### **⭐ STEP 3: Phase 2 실행 (우선순위 최고)** (75분)
**중요**: 이 단계에서 반드시 다음 순서로 진행합니다:

**3-1. `docs/progress/v1/ri_1.md` 정합성 보정 (25분) - 먼저 실행**
```bash
# 다음 4개 항목을 ri_1.md에서 수정:
# 1. ri_1.md:3 - "resolve-issue 1" 안내 제거 → scripts/ai.py 사용 예시로 대체
# 2. ri_1.md:69 - Missing Files → "필수 파일 목록"으로 변경
# 3. ri_1.md:119 - 디렉터리 생성 지시 제거 → 파일 검토·수정 절차로 교체
# 4. ri_1.md:253 - Compose 예시 삭제 → "기존 docker/compose.p1.yml을 기준으로 조정"으로 교체

# 검증
grep -n "resolve-issue 1" docs/progress/v1/ri_1.md  # 없어야 함
grep -n "scripts/ai.py\|scripts/approval_cli.py" docs/progress/v1/ri_1.md  # 있어야 함
```

**3-2. CHANGELOG.md 작성 (35분) - ri_1.md 수정 후 실행**
```bash
# CHANGELOG.md 생성 및 v1.5.0 섹션 작성
# - Added: 5개 이상 항목
# - Changed: 3개 이상 항목
# - Fixed: Documentation 항목 (ri_1.md 정합성 보정 포함)
# - Performance, Testing, Documentation 섹션 포함
vim CHANGELOG.md
```

**3-3. 프로젝트 문서 동기화 (15분) - CHANGELOG 완료 후 실행**
```bash
# CLAUDE.md 업데이트
vim CLAUDE.md

# README.md 동기화 확인 (필요 시)
vim README.md
```

#### **STEP 4: Phase 3 실행** (30-60분)
```bash
# Git 태그 생성
git tag -a v1.5.0 -m "Release v1.5.0 - Approval Workflow UX

Phase 2 에서 ri_1.md 정합성 보정 포함"
git push origin v1.5.0

# GitHub Release 생성
gh release create v1.5.0 --draft
```

---

### 📋 체크리스트

- [ ] **Phase 0 완료**: 승인 UX 사전 조건 검증 ✅
- [ ] **Phase 1 완료**: 144개 테스트 실행, 회귀 검증 ✅
- [ ] **⭐ Phase 2-1 완료**: `docs/progress/v1/ri_1.md` 정합성 보정
  - [ ] ri_1.md:3 수정 (`resolve-issue 1` 제거)
  - [ ] ri_1.md:69 수정 (Missing Files → 필수 파일 목록)
  - [ ] ri_1.md:119 수정 (디렉터리 생성 제거)
  - [ ] ri_1.md:253 수정 (Compose 예시 → 조정 가이드)
- [ ] **Phase 2-2 완료**: CHANGELOG.md 작성 (ri_1.md 보정 항목 포함)
- [ ] **Phase 2-3 완료**: CLAUDE.md, README.md 동기화
- [ ] **Phase 3 완료**: Git 태그 및 GitHub Release 생성

---

## 📝 참고 문서

- **Issue #26 구현 계획**: `docs/progress/v1/ri_13.md`
- **승인 정책 문서**: `docs/security/APPROVAL_POLICY.md`
- **성능 벤치마크**: `docs/benchmarks/approval_workflow_phase5.md`
- **PR #27 Diff**: `gh pr view 27 --json files`
- **테스트 수량 보고서**: `docs/test_count_report.json`

---

## 💡 구현 참고 사항

### CHANGELOG.md 형식
- [Keep a Changelog](https://keepachangelog.com/en/1.0.0/) 표준 준수
- Semantic Versioning 2.0.0 적용
- Added/Changed/Fixed/Performance/Testing/Documentation 섹션 구분

### GitHub Release Notes 작성 팁
- Highlights: 주요 기능 3-5개 간략 요약
- What's Changed: CHANGELOG 내용 요약
- Installation: 신규 설치 및 업그레이드 가이드
- Configuration: 주요 환경 변수 예시
- Known Issues: 알려진 문제 (없으면 "None")

### Git Tag 규칙
- Annotated tag 사용 (`-a` 플래그)
- 메시지에 주요 변경사항 포함
- Semantic Versioning: MAJOR.MINOR.PATCH
  - MAJOR: Breaking changes
  - MINOR: Feature additions (← v1.5.0)
  - PATCH: Bug fixes

---

**끝.**
