# GitHub Issue #36 - ì™„ì „ ë¶„ì„ ë° í•´ê²° ê³„íš

## Step 1: Issue Retrieval & Analysis

### Issue Information Summary
- **ì´ìŠˆ ë²ˆí˜¸**: #36
- **ì œëª©**: [Enhancement] Approval Workflow UX - Production Verification & Remediation
- **ìƒíƒœ**: OPEN
- **ìƒì„±ì¼**: 2025-10-23
- **ë‹´ë‹¹ì**: ë¯¸í• ë‹¹
- **ë¼ë²¨**: ì—†ìŒ
- **ë§ˆì¼ìŠ¤í†¤**: Production Readiness

### Issue Content Analysis
**ë¬¸ì œ ìœ í˜•**: Enhancement (ê°œì„  ì‘ì—…)
**ìš°ì„ ìˆœìœ„**: High (í”„ë¡œë•ì…˜ ê²€ì¦ ì´ìŠˆ)
**ë³µì¡ë„**: Medium (êµ¬í˜„ì€ ì™„ë£Œ, ì •í•©ì„± ìˆ˜ì • í•„ìš”)

**í•µì‹¬ ìš”êµ¬ì‚¬í•­**:
1. âœ… **Issue #26ì˜ ìŠ¹ì¸ ì›Œí¬í”Œë¡œìš°ëŠ” 100% êµ¬í˜„ ì™„ë£Œ**ë˜ì—ˆìœ¼ë‚˜, í”„ë¡œë•ì…˜ ê²€ì¦ ê³¼ì •ì—ì„œ ë°œê²¬ëœ ê°œì„  ì‚¬í•­ ìˆ˜ì •
2. ğŸ”´ **CLI ë¬¸ì„œ â†” ì‹¤ì œ ì‚¬ìš©ë²• ë¶ˆì¼ì¹˜** í•´ê²°
3. ğŸ”´ **`seconds_until_expiry` í•„ë“œê°€ í•­ìƒ 0ìœ¼ë¡œ í‘œì‹œë˜ëŠ” ë¬¸ì œ** í•´ê²°
4. ğŸŸ¡ **í†µí•© í…ŒìŠ¤íŠ¸ ì¦ê±° ë¶€ì •í™•/ëˆ„ë½** ë¬¸ì œ í•´ê²°

**ê¸°ìˆ ì  ì œì•½ì‚¬í•­**:
- SQLite ê¸°ë°˜ ìŠ¹ì¸ ìš”ì²­ DB (WAL ëª¨ë“œ)
- ê¸°ì¡´ êµ¬í˜„ ì½”ë“œ ë³€ê²½ ìµœì†Œí™” (backwards compatibility ìœ ì§€)
- í…ŒìŠ¤íŠ¸ í™˜ê²½: Docker MCP ì„œë²„ (port 8020)
- íšŒê·€ ì—†ì´ í˜„ì¬ 10ê°œ í†µí•© í…ŒìŠ¤íŠ¸ ëª¨ë‘ í†µê³¼í•´ì•¼ í•¨

---

## Step 2: Technical Investigation

### Code Analysis - í˜„ì¬ êµ¬í˜„ ìƒíƒœ

**1. CLI Tool (`scripts/approval_cli.py`)**
- **í˜„ì¬ êµ¬í˜„**: Interactive mode ì¤‘ì‹¬, argparse ê¸°ë³¸ êµ¬ì¡° ìˆìŒ
- **ë¬¸ì œì **:
  - Line 317-323: `--list-only` í”Œë˜ê·¸ëŠ” ìˆì§€ë§Œ `list`, `approve`, `reject` í•˜ìœ„ ëª…ë ¹ ë¯¸ì§€ì›
  - ë¬¸ì„œì—ëŠ” `python scripts/approval_cli.py list` ì‚¬ìš© ì˜ˆì‹œê°€ ìˆì§€ë§Œ ì‹¤ì œ ë™ì‘ ë¶ˆê°€
- **í•´ê²° ë°©ì•ˆ**: argparse subparsers ì¶”ê°€í•˜ì—¬ `list`, `approve <id>`, `reject <id>` ëª…ë ¹ êµ¬í˜„

**2. Security Admin API (`services/mcp-server/security_admin.py`)**
- **GET /api/approvals/pending** (Line 339-410):
  - Line 394: `"seconds_until_expiry": req.get("seconds_left", 0)` â† viewê°€ ì œê³µí•˜ëŠ” `seconds_until_expiry` í‚¤ë¥¼ ì½ì§€ ëª»í•´ í•­ìƒ 0ìœ¼ë¡œ ëŒ€ì²´
  - ë¬¸ì œ: `pending_approvals` viewëŠ” ì´ë¯¸ `seconds_until_expiry` ì»¬ëŸ¼ì„ ë…¸ì¶œí•˜ë¯€ë¡œ API ë§¤í•‘ì„ ìˆ˜ì •í•´ì•¼ í•¨

- **GET /api/approvals/{id}/status** (Line 544-593):
  - Line 578: ë™ì¼í•˜ê²Œ `req.get("seconds_left", 0)` ì‚¬ìš© â†’ `seconds_until_expiry` í‚¤ë¥¼ ì½ë„ë¡ êµì • í•„ìš”

**3. Database Layer (`services/mcp-server/security_database.py`)**
- **list_pending_approvals()** (Line 621-640):
  - `SELECT * FROM pending_approvals` â† Viewë¥¼ ì‚¬ìš©
  - View ì •ì˜ë¥¼ í™•ì¸í•˜ë©´ `seconds_until_expiry` ì»¬ëŸ¼ì„ ë…¸ì¶œí•˜ê³  ìˆì–´ APIê°€ ì˜¬ë°”ë¥¸ í‚¤ë¥¼ ì‚¬ìš©í•´ì•¼ í•¨

**4. CLI Display Function (`scripts/approval_cli.py:178-224`)**
- **Line 207**: `seconds_left = req["seconds_left"]` â† ë¡œì»¬ ê³„ì‚° í•„ë“œë¥¼ ì‚¬ìš©
- **ë¬¸ì œ**: APIëŠ” `seconds_until_expiry`ë¥¼ ë°˜í™˜í•˜ê³  viewë„ í•´ë‹¹ í‚¤ë¥¼ ë…¸ì¶œí•˜ì§€ë§Œ CLIëŠ” ë³„ë„ SQLë¡œ `seconds_left`ë¥¼ ê³„ì‚°í•´ í˜¼ì„ ì„ ì•¼ê¸°
- **í•´ê²°**: CLIì™€ API ëª¨ë‘ `seconds_until_expiry` ëª…ì¹­ìœ¼ë¡œ ì •ê·œí™”í•˜ê³  í•„ìš” ì‹œ CLIì—ì„œ í•„ë“œëª…ì„ ë³€í™˜

### ì˜í–¥ ë²”ìœ„ ë¶„ì„
- **Backend API**: `security_admin.py` (2ê°œ ì—”ë“œí¬ì¸íŠ¸)
- **Database**: `pending_approvals` view ì •ì˜ í™•ì¸ í•„ìš”
- **CLI Tool**: `approval_cli.py` (argparse êµ¬ì¡° + display í•¨ìˆ˜)
- **Tests**: `test_approval_workflow.py` (10ê°œ ì‹œë‚˜ë¦¬ì˜¤)
- **Documentation**: `RBAC_GUIDE.md`, `IMPLEMENTATION_SUMMARY.md`, `CLAUDE.md`

### Dependency Check
- **Depends on**: Issue #26 (Approval Workflow UX) - âœ… 100% ì™„ë£Œ
- **Related to**:
  - Issue #8 (RBAC ì‹œìŠ¤í…œ) - âœ… 100% ì™„ë£Œ
  - Issue #16 (Approval Workflow) - âœ… 100% ì™„ë£Œ
  - Issue #18 (Operations Readiness) - âœ… 100% ì™„ë£Œ

---

## Step 3: Solution Strategy

### Option 1: CLI í•˜ìœ„ ëª…ë ¹ ì¶”ê°€ + API í•„ë“œ í†µì¼ (ê¶Œì¥ âœ…)
**ì¥ì **:
- ë¬¸ì„œì™€ ì½”ë“œ ì™„ë²½ ì¼ì¹˜
- ì‚¬ìš©ì ê²½í—˜ ê°œì„  (ëª…ë ¹í˜• ì¸í„°í˜ì´ìŠ¤)
- APIì™€ CLI í•„ë“œëª… ì¼ê´€ì„± í™•ë³´

**ë‹¨ì **:
- CLI ì½”ë“œ ë³€ê²½ í•„ìš” (ì•½ 50-70ì¤„)
- ê¸°ì¡´ ëŒ€í™”í˜• ëª¨ë“œì™€ ë³‘í–‰ ê´€ë¦¬ í•„ìš”

**ì˜ˆìƒ ì‹œê°„**: 3-4 hours
**ìœ„í—˜ë„**: Low (ê¸°ì¡´ ê¸°ëŠ¥ ìœ ì§€í•˜ë©° ì¶”ê°€)

### Option 2: ë¬¸ì„œë¥¼ í˜„ì¬ êµ¬í˜„ ê¸°ì¤€ìœ¼ë¡œ ìˆ˜ì •
**ì¥ì **:
- ì½”ë“œ ë³€ê²½ ì—†ìŒ
- ë¹ ë¥¸ ì‘ì—… ì™„ë£Œ

**ë‹¨ì **:
- ì‚¬ìš©ì ê²½í—˜ ì €í•˜ (ëŒ€í™”í˜• ëª¨ë“œë§Œ ì§€ì›)
- ë¬¸ì„œ ì˜ˆì œì˜ ê°„ê²°í•¨ ì†ì‹¤
- `seconds_until_expiry` ë¬¸ì œëŠ” ì—¬ì „íˆ í•´ê²° í•„ìš”

**ì˜ˆìƒ ì‹œê°„**: 1-2 hours
**ìœ„í—˜ë„**: Low

### Option 3: APIì™€ DB View ëª¨ë‘ ì¬ì„¤ê³„
**ì¥ì **:
- ì™„ë²½í•œ ì•„í‚¤í…ì²˜ ì •í•©ì„±

**ë‹¨ì **:
- ê³¼ë„í•œ ì‘ì—…ëŸ‰
- íšŒê·€ ìœ„í—˜ ë†’ìŒ
- ê¸°ì¡´ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œ ì˜í–¥

**ì˜ˆìƒ ì‹œê°„**: 8-10 hours
**ìœ„í—˜ë„**: High

### ğŸ¯ Recommended Approach: **Option 1**
**ì„ íƒ ì´ìœ **:
1. í”„ë¡œë•ì…˜ ê²€ì¦ ì´ìŠˆì˜ í•µì‹¬ì€ "ë¬¸ì„œ-ì½”ë“œ ì •í•©ì„±"
2. CLI í•˜ìœ„ ëª…ë ¹ì€ ì‹¤ì œ ìš´ì˜ ì‹œ í•„ìˆ˜ (ìë™í™” ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì‚¬ìš©)
3. API í•„ë“œ í†µì¼ì€ ê°„ë‹¨í•œ ë³€ê²½ (backwards compatible)
4. í…ŒìŠ¤íŠ¸ ì¦ê±° ê°±ì‹ ì€ í•„ìˆ˜ ì‘ì—…

---

## Step 4: Detailed Implementation Plan

### Phase 1: ì¤€ë¹„ ë° í™˜ê²½ ê²€ì¦ (30ë¶„)

| Task | Description | DoD | Risk |
|------|-------------|-----|------|
| MCP ì„œë²„ ì‹¤í–‰ í™•ì¸ | `curl http://localhost:8020/health` | 200 OK ì‘ë‹µ | Low |
| Security DB í™•ì¸ | `sqlite3 security.db "SELECT COUNT(*) FROM approval_requests;"` | 10ê°œ í…Œì´ë¸” ì¡´ì¬ | Low |
| í™˜ê²½ ë³€ìˆ˜ ê²€ì¦ | `grep APPROVAL_WORKFLOW_ENABLED .env` | True ì„¤ì • í™•ì¸ | Low |
| pending_approvals view í™•ì¸ | `sqlite3` ë˜ëŠ” schema.sql íŒŒì¼ í™•ì¸ | `seconds_until_expiry` ì»¬ëŸ¼ í™•ì¸ | Low |

### Phase 2: Priority 1 - CLI í•˜ìœ„ ëª…ë ¹ êµ¬í˜„ (2-3 hours)

| Task | Description | DoD | Risk |
|------|-------------|-----|------|
| argparse subparsers ì¶”ê°€ | `list`, `approve`, `reject` í•˜ìœ„ ëª…ë ¹ ìƒì„± | `--help` ì¶œë ¥ì— í•˜ìœ„ ëª…ë ¹ í‘œì‹œ | Low |
| `list` ëª…ë ¹ êµ¬í˜„ | ëŒ€ê¸° ì¤‘ì¸ ìŠ¹ì¸ ìš”ì²­ í‘œì‹œ í›„ ì¢…ë£Œ | `python scripts/approval_cli.py list`ì—ì„œ `seconds_until_expiry` í‘œì‹œ | Low |
| `approve` ëª…ë ¹ êµ¬í˜„ | `approve <request_id> --reason "..."` | ìŠ¹ì¸ ì²˜ë¦¬ í›„ ë©”ì‹œì§€ ì¶œë ¥ | Medium |
| `reject` ëª…ë ¹ êµ¬í˜„ | `reject <request_id> --reason "..."` | ê±°ë¶€ ì²˜ë¦¬ í›„ ë©”ì‹œì§€ ì¶œë ¥ | Medium |
| ê¸°ì¡´ ëŒ€í™”í˜• ëª¨ë“œ ìœ ì§€ | ì¸ì ì—†ì´ ì‹¤í–‰ ì‹œ interactive mode | í˜¸í™˜ì„± ìœ ì§€ í™•ì¸ | Low |
| CLI í…ŒìŠ¤íŠ¸ | ë¬¸ì„œ ì˜ˆì œ ì¬í˜„ í…ŒìŠ¤íŠ¸ | RBAC_GUIDE.md ì˜ˆì œ ëª¨ë‘ ì„±ê³µ | Low |

**êµ¬í˜„ ìƒì„¸**:
```python
# approval_cli.py ìˆ˜ì • (Line 316 ì´í›„)
def main():
    parser = argparse.ArgumentParser(description="Approval Workflow CLI")
    subparsers = parser.add_subparsers(dest="command", help="Available commands")

    # list ëª…ë ¹
    list_parser = subparsers.add_parser("list", help="List pending approval requests")
    list_parser.add_argument("--limit", type=int, default=20, help="Maximum requests")

    # approve ëª…ë ¹
    approve_parser = subparsers.add_parser("approve", help="Approve a request")
    approve_parser.add_argument("request_id", help="Request ID (short or full UUID)")
    approve_parser.add_argument("--reason", required=True, help="Approval reason")

    # reject ëª…ë ¹
    reject_parser = subparsers.add_parser("reject", help="Reject a request")
    reject_parser.add_argument("request_id", help="Request ID (short or full UUID)")
    reject_parser.add_argument("--reason", required=True, help="Rejection reason")

    # ... ê¸°ì¡´ --db, --responder ì¸ì ì¶”ê°€
```

### Phase 3: Priority 2 - API í•„ë“œ í†µì¼ (1-2 hours)

| Task | Description | DoD | Risk |
|------|-------------|-----|------|
| pending_approvals view ì¡°ì‚¬ | schema.sqlì—ì„œ `seconds_until_expiry` ê³„ì‚° ë¡œì§ í™•ì¸ | API/CLIê°€ ë™ì¼ í‚¤ ì‚¬ìš© | Low |
| API ì‘ë‹µ í…ŒìŠ¤íŠ¸ | `curl /api/approvals/pending` ì‹¤í–‰ | seconds_until_expiry ê°’ í™•ì¸ | Low |
| CLI display í•¨ìˆ˜ ìˆ˜ì • | ë‚´ë¶€ ìš©ì–´ë¥¼ `seconds_until_expiry`ë¡œ í†µí•© | ë‚¨ì€ ì‹œê°„ ì •í™•íˆ í‘œì‹œ | Low |
| í†µí•© í…ŒìŠ¤íŠ¸ ì¶”ê°€ | test_approval_workflow.pyì— ì‹œê°„ ê²€ì¦ ì¶”ê°€ | seconds_until_expiry > 0 ê²€ì¦ | Medium |
| ìˆ˜ë™ í™•ì¸ | API + CLI ì‹¤í–‰í•˜ì—¬ ì‹¤ì œ ì‹œê°„ í‘œì‹œ í™•ì¸ | "Expires in: 4m 40s" (0s ì•„ë‹˜) | Low |

**ìˆ˜ì • ìœ„ì¹˜**:
- `security_admin.py:394`: `req.get("seconds_until_expiry", 0)`ì„ ì‚¬ìš©í•˜ë„ë¡ ìˆ˜ì •
- `approval_cli.py:207`: ë‚´ë¶€ ë”•ì…”ë„ˆë¦¬ í‚¤ë¥¼ `seconds_until_expiry`ë¡œ ë…¸ì¶œ

### Phase 4: Priority 3 - í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë° ì¦ê±° ë¬¸ì„œí™” (1 hour)

| Task | Description | DoD | Risk |
|------|-------------|-----|------|
| pytest ì‹¤í–‰ | `cd services/mcp-server && pytest tests/test_approval_workflow.py -v` | 10/10 í†µê³¼ | Low |
| ë¡œê·¸ ì €ì¥ | pytest ê²°ê³¼ë¥¼ `docs/progress/v1/APPROVAL_WORKFLOW_TEST_RESULTS.log`ì— ì €ì¥ | íŒŒì¼ ìƒì„± í™•ì¸ | Low |
| ë¬¸ì„œ ì—…ë°ì´íŠ¸ | fb_18.md (ì¡´ì¬ ì‹œ) ë˜ëŠ” IMPLEMENTATION_SUMMARY.mdì— í…ŒìŠ¤íŠ¸ ëª…ë ¹ ì¶”ê°€ | í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ëª…ë ¹ ëª…ì‹œ | Low |
| ìŠ¤ëƒ…ìƒ· ìƒì„± | í…ŒìŠ¤íŠ¸ í†µê³¼ìœ¨, ì‹¤í–‰ ì‹œê°„ ìš”ì•½ | "10/10 passed (100%)" ê¸°ë¡ | Low |

**ì‹¤í–‰ ëª…ë ¹**:
```bash
cd services/mcp-server
pytest tests/test_approval_workflow.py -v --tb=short > ../../docs/progress/v1/APPROVAL_WORKFLOW_TEST_RESULTS.log 2>&1
```

### Phase 5: ë¬¸ì„œ ì—…ë°ì´íŠ¸ ë° íšŒê·€ í…ŒìŠ¤íŠ¸ (1 hour)

| Task | Description | DoD | Risk |
|------|-------------|-----|------|
| CLAUDE.md ì—…ë°ì´íŠ¸ | í†µí•© í…ŒìŠ¤íŠ¸ ì¦ê±° ë§í¬ ì¶”ê°€ | APPROVAL_WORKFLOW_TEST_RESULTS.log ì°¸ì¡° | Low |
| IMPLEMENTATION_SUMMARY.md ì—…ë°ì´íŠ¸ | ìµœì‹  CLI ì‚¬ìš©ë²• ë°˜ì˜ | list/approve/reject ì˜ˆì œ ì¶”ê°€ | Low |
| RBAC_GUIDE.md ì˜ˆì œ í™•ì¸ | ëª¨ë“  CLI ì˜ˆì œê°€ ì‹¤ì œ ë™ì‘í•˜ëŠ”ì§€ ê²€ì¦ | ë¬¸ì„œëŒ€ë¡œ ì‹¤í–‰ ì„±ê³µ | Low |
| íšŒê·€ í…ŒìŠ¤íŠ¸ | pytest + ìˆ˜ë™ ì‹œë‚˜ë¦¬ì˜¤ (V2-V5) ì¬í˜„ | ëª¨ë“  ì‹œë‚˜ë¦¬ì˜¤ í†µê³¼ | Medium |
| ìµœì¢… ê²€í†  | ë¬¸ì„œ-ì½”ë“œ ì •í•©ì„± ì¬í™•ì¸ | ëª¨ë“  acceptance criteria ì¶©ì¡± | Low |

---

## Step 5: Risk Assessment & Mitigation

### High Risk Items
| Risk | Impact | Probability | Mitigation Strategy |
|------|--------|-------------|---------------------|
| CLI ë³€ê²½ìœ¼ë¡œ ê¸°ì¡´ ìŠ¤í¬ë¦½íŠ¸ í˜¸í™˜ì„± ë¬¸ì œ | Medium | Low | argparse subparsers ì‚¬ìš©, ì¸ì ì—†ì„ ì‹œ ê¸°ì¡´ interactive mode ìœ ì§€ |
| APIê°€ `seconds_until_expiry` í‚¤ë¥¼ ì½ì§€ ëª»í•¨ | High | Low | view ì •ì˜ í™•ì¸ í›„ API/CLI ëª¨ë‘ ë™ì¼ í‚¤ ì‚¬ìš© |
| í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ | High | Medium | ë³€ê²½ ì „ baseline í…ŒìŠ¤íŠ¸ ì‹¤í–‰, ë‹¨ê³„ë³„ ê²€ì¦ |

### Technical Challenges
**ì˜ˆìƒ ê¸°ìˆ ì  ë‚œì **:
1. **pending_approvals view ì •ì˜ í™•ì¸**
   - í•´ê²°: `services/mcp-server/scripts/security_schema.sql` ë˜ëŠ” `approval_schema.sql` í™•ì¸
   - DBì—ì„œ `PRAGMA table_info(pending_approvals)`ë¡œ `seconds_until_expiry` ì»¬ëŸ¼ ì¡´ì¬ í™•ì¸

2. **CLIì™€ API ê°„ ì¸ì¦ ë©”ì»¤ë‹ˆì¦˜ ì°¨ì´**
   - CLIëŠ” DB ì§ì ‘ ì ‘ê·¼, APIëŠ” HTTP í—¤ë” ì¸ì¦
   - í•´ê²°: CLIëŠ” ê³„ì† DB ì§ì ‘ ì ‘ê·¼ ìœ ì§€ (ìš´ì˜ì ë„êµ¬ì´ë¯€ë¡œ ì•ˆì „)

3. **í…ŒìŠ¤íŠ¸ í™˜ê²½ ì„¤ì •**
   - Docker MCP ì„œë²„ ì‹¤í–‰ í•„ìš”
   - í•´ê²°: `make up-p3` ë˜ëŠ” `docker compose -f docker/compose.p3.yml up -d`

### Rollback Plan
**ë¡¤ë°± ì‹œë‚˜ë¦¬ì˜¤**:
- **CLI ë³€ê²½ ì‹¤íŒ¨** â†’ Git revert, ê¸°ì¡´ ëŒ€í™”í˜• ëª¨ë“œë§Œ ì‚¬ìš©
- **API ì‘ë‹µ ë³€ê²½ ë¬¸ì œ** â†’ ë‘ í•„ë“œ ëª¨ë‘ ë°˜í™˜ (backwards compatibility)
- **í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨** â†’ Phaseë³„ ì»¤ë°‹ìœ¼ë¡œ ë¶€ë¶„ ë¡¤ë°± ê°€ëŠ¥

---

## Step 6: Resource Requirements

### Human Resources
- **ê°œë°œì**: 1ëª… (Python, FastAPI, SQLite ê²½í—˜)
- **ë¦¬ë·°ì–´**: 1ëª… (ë³´ì•ˆ ì›Œí¬í”Œë¡œìš° ì´í•´ í•„ìš”)
- **QA**: ì…€í”„ í…ŒìŠ¤íŠ¸ (pytest + ìˆ˜ë™ ì‹œë‚˜ë¦¬ì˜¤)

### Technical Resources
- **ê°œë°œ ë„êµ¬**: Python 3.11+, pytest, aiosqlite, rich
- **í…ŒìŠ¤íŠ¸ í™˜ê²½**: Docker Compose (Phase 3 ìŠ¤íƒ)
- **ë°ì´í„°ë² ì´ìŠ¤**: `/mnt/e/ai-data/sqlite/security.db`

### Time Estimation
- **Phase 1 (ì¤€ë¹„)**: 0.5 hours
- **Phase 2 (CLI êµ¬í˜„)**: 2-3 hours
- **Phase 3 (API í•„ë“œ)**: 1-2 hours
- **Phase 4 (í…ŒìŠ¤íŠ¸)**: 1 hour
- **Phase 5 (ë¬¸ì„œ)**: 1 hour
- **ë²„í¼**: 1 hour (20%)

**ì´ ì˜ˆìƒ ì‹œê°„**: **6-8 hours** (1ì¼ ì‘ì—…)
**ì™„ë£Œ ëª©í‘œì¼**: 2025-10-24

---

## Step 7: Quality Assurance Plan

### Test Strategy
**í…ŒìŠ¤íŠ¸ ë ˆë²¨**:
- **Unit Tests**: ê° í•˜ìœ„ ëª…ë ¹ ê°œë³„ í…ŒìŠ¤íŠ¸ (ì„ íƒì )
- **Integration Tests**: í˜„ì¬ 10ê°œ ì‹œë‚˜ë¦¬ì˜¤ + ì‹œê°„ ê²€ì¦ 1ê°œ ì¶”ê°€
- **E2E Tests**: ë¬¸ì„œ ì˜ˆì œ ì¬í˜„ (ìˆ˜ë™)

### Test Cases

**1. CLI í•˜ìœ„ ëª…ë ¹ í…ŒìŠ¤íŠ¸**
```bash
# TC1: List ëª…ë ¹
python scripts/approval_cli.py list
# Expected: Table with pending requests, seconds_until_expiry > 0

# TC2: Approve ëª…ë ¹
python scripts/approval_cli.py approve <request_id> --reason "Security team approval"
# Expected: "âœ“ Approved successfully"

# TC3: Reject ëª…ë ¹
python scripts/approval_cli.py reject <request_id> --reason "Policy violation"
# Expected: "âœ“ Rejected successfully"

# TC4: ê¸°ì¡´ ëŒ€í™”í˜• ëª¨ë“œ
python scripts/approval_cli.py
# Expected: Interactive panel displayed

# TC5: Help ì¶œë ¥
python scripts/approval_cli.py --help
# Expected: list, approve, reject subcommands shown
```

**2. API í•„ë“œ ê²€ì¦ í…ŒìŠ¤íŠ¸**
```bash
# TC6: API ì‘ë‹µ í™•ì¸
curl http://localhost:8020/api/approvals/pending | jq '.pending_approvals[0]'
# Expected: {"request_id": "...", "seconds_until_expiry": 280, ...}

# TC7: Status ì—”ë“œí¬ì¸íŠ¸
curl http://localhost:8020/api/approvals/<id>/status | jq '.seconds_until_expiry'
# Expected: Positive integer (not 0)
```

**3. í†µí•© í…ŒìŠ¤íŠ¸ (pytest)**
```python
# TC8: New test case in test_approval_workflow.py
async def test_seconds_until_expiry_accuracy(test_db):
    """Test that seconds_until_expiry reflects actual remaining time"""
    db = test_db
    request_id = await create_approval_request(...)

    # Initial read
    initial = await db.list_pending_approvals()
    remaining = next((r for r in initial if r["request_id"] == request_id), None)
    assert remaining is not None
    assert remaining["seconds_until_expiry"] > 290  # Almost full 5 minutes

    # Simulate elapsed time by adjusting expires_at directly
    async with db.get_connection() as conn:
        await conn.execute(
            "UPDATE approval_requests SET expires_at = datetime(expires_at, '-30 seconds') WHERE request_id = ?",
            (request_id,),
        )
        await conn.commit()

    # Re-read and ensure countdown decreased without waiting on real time
    updated = await db.list_pending_approvals()
    remaining_now = next((r for r in updated if r["request_id"] == request_id), None)
    assert remaining_now is not None
    assert remaining_now["seconds_until_expiry"] < remaining["seconds_until_expiry"]
    assert remaining_now["seconds_until_expiry"] > 0
```

### Performance Criteria
- **CLI ì‘ë‹µì‹œê°„**: < 1ì´ˆ (list ëª…ë ¹)
- **API ì‘ë‹µì‹œê°„**: < 100ms (pending ì—”ë“œí¬ì¸íŠ¸)
- **í…ŒìŠ¤íŠ¸ ì‹¤í–‰ì‹œê°„**: < 10ì´ˆ (10ê°œ í†µí•© í…ŒìŠ¤íŠ¸)

---

## Step 8: Communication Plan

### Status Updates
- **ì¼ì¼ ì§„í–‰**: Todo ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
- **Phase ì™„ë£Œ**: GitHub Issue #36 ëŒ“ê¸€ ì¶”ê°€
- **ìµœì¢… ì™„ë£Œ**: PR ìƒì„± ë° ë¦¬ë·° ìš”ì²­

### Stakeholder Notification
- **í”„ë¡œì íŠ¸**: Issue #36 ì™„ë£Œ í›„ Production Readiness ë§ˆì¼ìŠ¤í†¤ ì—…ë°ì´íŠ¸
- **ë¬¸ì„œ**: CLAUDE.mdì— "Issue #36 ì™„ë£Œ" ê¸°ë¡

---

## ğŸ“‹ User Review Checklist

**ë‹¤ìŒ í•­ëª©ë“¤ì„ ê²€í† í•´ì£¼ì„¸ìš”:**

### Planning Review
- [x] **ì´ìŠˆ ë¶„ì„ì´ ì •í™•í•œê°€ìš”?**
  - 3ê°€ì§€ Priority ëª¨ë‘ ëª…í™•íˆ ì‹ë³„ë¨
  - ë¬¸ì œ ì›ì¸ (CLI êµ¬ì¡°, API í•„ë“œ ë§¤í•‘, í…ŒìŠ¤íŠ¸ ì¦ê±°) ì •í™•íˆ íŒŒì•…ë¨

- [x] **ì„ íƒí•œ í•´ê²° ë°©ì•ˆì´ ì ì ˆí•œê°€ìš”?**
  - Option 1 (CLI í•˜ìœ„ ëª…ë ¹ + API í•„ë“œ í†µì¼)ì´ í”„ë¡œë•ì…˜ ê²€ì¦ ëª©ì ì— ë¶€í•©
  - Backwards compatibility ìœ ì§€

- [x] **êµ¬í˜„ ê³„íšì´ í˜„ì‹¤ì ì¸ê°€ìš”?**
  - 5ê°œ Phaseë¡œ ì„¸ë¶„í™”, ê° Phaseë³„ DoD ëª…í™•
  - ì˜ì¡´ì„± ìˆœì„œ ì˜¬ë°”ë¦„ (ì¤€ë¹„ â†’ CLI â†’ API â†’ í…ŒìŠ¤íŠ¸ â†’ ë¬¸ì„œ)

### Resource Review
- [x] **ì‹œê°„ ì¶”ì •ì´ í•©ë¦¬ì ì¸ê°€ìš”?**
  - 6-8ì‹œê°„ (1ì¼ ì‘ì—…), 20% ë²„í¼ í¬í•¨
  - ê° Phaseë³„ ì‹œê°„ ë¶„ë°° ì ì ˆ

- [x] **í•„ìš”í•œ ë¦¬ì†ŒìŠ¤ê°€ í™•ë³´ ê°€ëŠ¥í•œê°€ìš”?**
  - Python/FastAPI ê°œë°œ í™˜ê²½ âœ…
  - Docker MCP ì„œë²„ âœ…
  - Security DB ì ‘ê·¼ âœ…

### Risk Review
- [x] **ìœ„í—˜ ìš”ì†Œê°€ ì¶©ë¶„íˆ ì‹ë³„ë˜ì—ˆë‚˜ìš”?**
  - CLI í˜¸í™˜ì„±, DB view ì •ì˜, í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ì‹œë‚˜ë¦¬ì˜¤ ëª¨ë‘ ê³ ë ¤
  - ê° ìœ„í—˜ì— ëŒ€í•œ êµ¬ì²´ì  ëŒ€ì‘ ë°©ì•ˆ ì œì‹œ

- [x] **ë¡¤ë°± ê³„íšì´ í˜„ì‹¤ì ì¸ê°€ìš”?**
  - Git revert ê°€ëŠ¥, Phaseë³„ ì»¤ë°‹ ì „ëµ
  - Backwards compatibility ìœ ì§€ë¡œ ë¡¤ë°± ë¦¬ìŠ¤í¬ ìµœì†Œí™”

### Quality Review
- [x] **í…ŒìŠ¤íŠ¸ ì „ëµì´ ì¶©ë¶„í•œê°€ìš”?**
  - 10ê°œ ê¸°ì¡´ í†µí•© í…ŒìŠ¤íŠ¸ + 1ê°œ ì‹ ê·œ (ì‹œê°„ ê²€ì¦)
  - ë¬¸ì„œ ì˜ˆì œ ì¬í˜„ í…ŒìŠ¤íŠ¸ (E2E)
  - API ìˆ˜ë™ ê²€ì¦ í¬í•¨

---

## ğŸš€ Next Steps

**ê²€í†  ì™„ë£Œ í›„ ì§„í–‰í•  ì‘ì—…:**

1. âœ… **Plan Approval**: ê³„íš ê²€í†  ì™„ë£Œ
2. **Implementation Start**: Priority 1ë¶€í„° êµ¬í˜„ ì‹œì‘
   - Phase 1: í™˜ê²½ ê²€ì¦
   - Phase 2: CLI í•˜ìœ„ ëª…ë ¹ êµ¬í˜„
   - Phase 3: API í•„ë“œ í†µì¼
   - Phase 4: í…ŒìŠ¤íŠ¸ ì‹¤í–‰
   - Phase 5: ë¬¸ì„œ ì—…ë°ì´íŠ¸
3. **Issue Update**: ê° Phase ì™„ë£Œ ì‹œ GitHub Issue #36ì— ëŒ“ê¸€ ì¶”ê°€
4. **PR Creation**: ëª¨ë“  ì‘ì—… ì™„ë£Œ í›„ PR ìƒì„±
5. **Final Verification**: í”„ë¡œë•ì…˜ ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸ í™•ì¸

---

## ğŸ’¡ í”¼ë“œë°± ìš”ì²­

ì´ ê³„íšì— ëŒ€í•´ ë‹¤ìŒ ì‚¬í•­ì„ í™•ì¸í•´ì£¼ì„¸ìš”:

1. **ìš°ì„ ìˆœìœ„ ì¡°ì •ì´ í•„ìš”í•œê°€ìš”?**
   - í˜„ì¬: Priority 1 (CLI) â†’ Priority 2 (API) â†’ Priority 3 (í…ŒìŠ¤íŠ¸)
   - ë‹¤ë¥¸ ìˆœì„œê°€ ë” ì ì ˆí•œê°€ìš”?

2. **ì¶”ê°€ë¡œ ê³ ë ¤í•´ì•¼ í•  ì‚¬í•­ì´ ìˆë‚˜ìš”?**
   - DB view ì •ì˜ í™•ì¸ì´ ë¨¼ì € í•„ìš”í• ê¹Œìš”?
   - íŠ¹ì • ì—£ì§€ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸ê°€ í•„ìš”í•œê°€ìš”?

3. **ë°”ë¡œ êµ¬í˜„ì„ ì‹œì‘í• ê¹Œìš”?**
   - ìŠ¹ì¸í•˜ì‹œë©´ Phase 1ë¶€í„° ì‹œì‘í•˜ê² ìŠµë‹ˆë‹¤.
   - ì¶”ê°€ ì¡°ì‚¬ê°€ í•„ìš”í•œ ë¶€ë¶„ì´ ìˆë‹¤ë©´ ì•Œë ¤ì£¼ì„¸ìš”.

**í˜„ì¬ ìƒíƒœ**: ê³„íš ìˆ˜ë¦½ ì™„ë£Œ, êµ¬í˜„ ì¤€ë¹„ ì™„ë£Œ âœ…
