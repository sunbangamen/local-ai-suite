# Issue #40 해결 계획서

**작성일**: 2025-10-24
**이슈**: [Enhancement] 승인 워크플로우 운영화 개선 - 문서화, CLI/서버 관리 기능 확장
**브랜치**: issue-40

---

## Step 1: Issue 정보 요약

**이슈 번호**: #40
**제목**: [Enhancement] 승인 워크플로우 운영화 개선 - 문서화, CLI/서버 관리 기능 확장
**상태**: OPEN
**생성일**: 2025-10-24
**URL**: https://github.com/sunbangamen/local-ai-suite/issues/40

### 핵심 요구사항

Issue #26에서 구현된 승인 워크플로우의 **프로덕션 운영 준비**를 위한 개선:

1. **문서화 부족**: IMPLEMENTATION_SUMMARY.md에 승인 플래그 기본값, 배포 절차, 로그 수집 가이드 누락
2. **CLI 환경 변수 미처리**: `scripts/ai.py`가 `APPROVAL_WORKFLOW_ENABLED` 환경 변수를 체크하지 않음
3. **서버 관리 기능 부족**: 단일 승인만 처리 가능 (배치 API 없음), Prometheus 메트릭 노출 없음
4. **운영 도구 부족**: 운영팀을 위한 체크리스트, 롤백 전략, 로그 조회 쿼리 미제공

### 문제 유형
- **Enhancement** (기존 기능 개선)
- **우선순위**: Medium-High (프로덕션 준비)
- **복잡도**: Medium (문서화 50% + 코드 30% + 테스트 20%)

---

## Step 2: 코드베이스 분석 결과

### 현재 구현 상태 (Issue #26 완료분)

✅ **완료된 기능 (및 한계):**
- RBAC 미들웨어에 승인 워크플로우 통합 (`rbac_middleware.py`)
- 3개 API 엔드포인트 구현 (`app.py:355-496`):
  - `GET /api/approvals/pending` - 대기 중인 승인 요청 조회
  - `POST /api/approvals/{request_id}/approve` - 승인 처리
  - `POST /api/approvals/{request_id}/reject` - 거부 처리
- CLI 승인 대기 핸들링 (`scripts/ai.py:178-324`):
  - Rich 기반 진행률 표시
  - 1초 폴링 간격으로 승인 상태 체크
  - 승인 시 자동 도구 재실행
- ✅ **Phase 2에서 추가됨**: `GET /api/approvals/{request_id}/status` 엔드포인트가 메인 MCP 서버(`services/mcp-server/app.py:499`)에 추가되어 CLI 폴링이 정상 동작
  - Short ID (첫 8자) 및 Full UUID 지원
  - 타임아웃 자동 감지
- 관리자용 CLI 도구 (`scripts/approval_cli.py`):
  - Rich TUI로 대기 중인 요청 조회
  - 승인/거부 처리 및 감사 로그 기록
- 감사 로깅 (`audit_logger.py`):
  - `log_approval_requested()`, `log_approval_granted()`, `log_approval_rejected()` 메서드

✅ **환경 변수 설정** (`.env.example:78-82`):
```bash
APPROVAL_WORKFLOW_ENABLED=false
APPROVAL_TIMEOUT=300
APPROVAL_POLLING_INTERVAL=1
APPROVAL_MAX_PENDING=50
```

### 영향 범위 분석

**수정 필요 파일:**
- **문서** (4개):
  - `docs/security/IMPLEMENTATION_SUMMARY.md` - 승인 플래그 기본값, 배포 절차 추가
  - `docs/security/OPERATIONS_GUIDE.md` (신규) - 운영팀 체크리스트, 롤백 전략
  - `docs/security/APPROVAL_GUIDE.md` - 로그 수집 쿼리 5개 추가
  - `CLAUDE.md` - Issue #40 완료 상태 반영

- **코드** (2개):
  - `scripts/ai.py` - `APPROVAL_WORKFLOW_ENABLED` 환경 변수 체크 추가, 상태 폴링 대상 호스트 조정
  - `services/mcp-server/app.py` - 승인 상태 API 노출(필수), 배치 승인 API/Prometheus 메트릭 추가 (Option 2 선택 시)

- **인프라** (1개):
  - `.env.example` - 환경 변수 문서화 개선

**테스트 필요 항목:**
- CLI 환경 변수 동작 (활성화/비활성화)
- 배치 승인 API pytest (Option 2 선택 시)
- Prometheus 메트릭 수집 검증 (Option 2 선택 시)

---

## Step 3: 해결 방안 전략

### Option 1: 최소 운영 준비 (문서 중심) ⭐ **권장**

**장점:**
- 빠른 배포 가능 (1-2일)
- 낮은 위험도 (코드 변경 최소화)
- 즉시 프로덕션 사용 가능

**단점:**
- 배치 승인 기능 없음 (수동 처리 필요)
- Prometheus 메트릭 없음 (별도 모니터링 필요)

**예상 시간:** 1.6일 (상태 API 포함 완료)
**위험도:** Low

---

### Option 2: 완전한 운영화 (코드 + 문서)

**장점:**
- 배치 승인으로 운영 효율성 향상
- Prometheus 통합으로 자동 모니터링
- 장기적 운영 안정성

**단점:**
- 배포 일정 지연 (2-3일)
- 새로운 API 테스트 필요 (회귀 위험)

**예상 시간:** 3일
**위험도:** Medium

---

### Option 3: 단계적 배포 (문서 → 코드)

**장점:**
- 1차 배포로 즉시 운영 가능
- 2차 배포로 점진적 개선

**단점:**
- 2회 배포 오버헤드
- 운영팀 학습 비용 2배

**예상 시간:** 1.5일 + 1.5일 (총 3일)
**위험도:** Medium

---

### ✅ 권장 접근법: **Option 1 (최소 운영 준비)**

**선택 이유:**
1. **빠른 프로덕션 투입**: 문서와 환경 변수 체크 작업만으로 즉시 운영 가능
2. **낮은 회귀 위험**: 추가 변경은 환경 변수 체크 로직 및 CLI 명령 추가 정도로 제한
3. **실용적 우선순위**: 배치 승인은 운영 경험 후 필요 시 추가
4. **Issue #26 완성도**: 핵심 기능은 이미 완료되어 추가 개발 범위가 작음
5. **상태 API 해결**: ✅ Phase 2에서 `GET /api/approvals/{id}/status` 엔드포인트 추가로 경로 불일치 이미 해결

**2차 개선 계획** (Issue #40 이후):
- 배치 승인 API는 실제 운영 경험 후 필요성 검증
- Prometheus 메트릭은 Issue #20 모니터링 시스템과 통합

---

## Step 4: 상세 구현 계획

### Phase 1: 문서화 강화 (Day 1, 4시간)

| Task | Description | DoD | Risk |
|------|-------------|-----|------|
| P1-T1 | ✅ IMPLEMENTATION_SUMMARY.md 개선 | ✅ 승인 플래그 기본값, Feature flag 섹션 추가, 배포 절차 3단계 명시 | Low |
| P1-T2 | ✅ OPERATIONS_GUIDE.md 작성 (신규) | ✅ 운영팀 체크리스트 10개, 롤백 전략 3개 시나리오, 로그 조회 SQL 5개 | Low |
| P1-T3 | ✅ APPROVAL_GUIDE.md 확장 | ✅ 로그 수집 섹션 추가 (SQL 쿼리 5개), 트러블슈팅 FAQ 5개 | Low |
| P1-T4 | ✅ .env.example 주석 개선 | ✅ APPROVAL_* 환경 변수 상세 설명, 운영 권장값 명시 | Low |

**완료 기준:**
- [x] ✅ 운영팀이 외부 도움 없이 배포 가능
- [x] ✅ 롤백 시나리오별 구체적 명령어 제공
- [x] ✅ 로그 조회 쿼리로 승인 이력 추적 가능

---

### Phase 2: CLI/서버 정합 및 환경 변수 처리 (Day 1-2, 3시간)

| Task | Description | DoD | Risk |
|------|-------------|-----|------|
| P2-T0 | ✅ 승인 상태 API 정비 | ✅ 메인 MCP에 `/api/approvals/{id}/status` 엔드포인트 추가 완료 (services/mcp-server/app.py:499) | Low |
| P2-T1 | ✅ ai.py 환경 변수 체크 | ✅ `APPROVAL_WORKFLOW_ENABLED` 체크 로직 추가 완료 (scripts/ai.py:180) | Low |
| P2-T2 | ✅ --approvals 명령 추가 | ✅ 사용자 승인 요청 조회 명령 추가 완료 (scripts/ai.py:1154) | Low |
| P2-T3 | ✅ 에러 처리 개선 | ✅ 타임아웃 메시지 및 3단계 가이드 추가 완료 (scripts/ai.py:293-300, 344-350) | Low |

**완료 기준:**
- [x] ✅ `APPROVAL_WORKFLOW_ENABLED=false` 시 승인 단계 스킵
- [x] ✅ `APPROVAL_WORKFLOW_ENABLED=true` 시 정상 동작
- [x] ✅ 환경 변수 미설정 시 기본값(false) 사용
- [x] ✅ CLI 폴링 시 404 미발생 (상태 API 엔드포인트 추가로 해결)

**코드 예시** (`scripts/ai.py:178` 이전에 추가):
```python
# Check if approval workflow is enabled
APPROVAL_ENABLED = os.getenv("APPROVAL_WORKFLOW_ENABLED", "false").lower() == "true"

if response.status_code == 403 and APPROVAL_ENABLED:
    # 기존 승인 처리 로직
    try:
        error_data = response.json()
        if error_data.get("approval_required"):
            request_id = error_data.get("request_id")
            return handle_approval_workflow(request_id, tool_name, kwargs)
    except Exception as e:
        print(f"⚠️ Error handling approval response: {e}")
elif response.status_code == 403:
    print("⚠️ Tool requires approval, but approval workflow is disabled")
    print("💡 Set APPROVAL_WORKFLOW_ENABLED=true to enable approval workflow")
    return None
```

---

### Phase 3: 검증 및 테스트 (Day 2, 2시간)

| Task | Description | DoD | Risk |
|------|-------------|-----|------|
| P3-T1 | CLI E2E 테스트 | 환경 변수 활성화/비활성화 시나리오 2개 수동 테스트 | Low |
| P3-T2 | 문서 검토 | 운영팀 리뷰 (체크리스트, 롤백 절차) | Low |
| P3-T3 | 시뮬레이션 로그 | 승인 요청 → 승인 → 도구 실행 전체 플로우 로그 수집 | Low |

**완료 기준:**
- [ ] CLI 환경 변수 체크 정상 동작 확인
- [ ] 롤백 절차 시뮬레이션 성공
- [ ] 로그 조회 쿼리로 전체 이력 추적 가능

**테스트 시나리오:**
> 사전 조건: 메인 MCP 서버에 `GET /api/approvals/{request_id}/status` 엔드포인트를 노출했거나,
> CLI가 보안 관리자 앱(`MCP_SECURITY_PORT`)으로 상태를 폴링하도록 구성되어 있어야 함.
```bash
# Scenario 1: 승인 워크플로우 활성화
export APPROVAL_WORKFLOW_ENABLED=true
python scripts/ai.py --mcp execute_python --mcp-args '{"code": "import os"}'
# 예상: 승인 대기 메시지 출력, 상태 API에서 200 응답 후 폴링 시작

# Scenario 2: 승인 워크플로우 비활성화
export APPROVAL_WORKFLOW_ENABLED=false
python scripts/ai.py --mcp execute_python --mcp-args '{"code": "import os"}'
# 예상: 403 에러 + 안내 메시지, 승인 폴링 스킵(상태 API 호출 없음)

# Scenario 3: 환경 변수 미설정 (기본값 false)
unset APPROVAL_WORKFLOW_ENABLED
python scripts/ai.py --mcp execute_python --mcp-args '{"code": "import os"}'
# 예상: Scenario 2와 동일 동작
```

---

### Phase 4: 배포 준비 (Day 2, 1시간)

| Task | Description | DoD | Risk |
|------|-------------|-----|------|
| P4-T1 | CLAUDE.md 업데이트 | Issue #40 완료 상태 반영 | Low |
| P4-T2 | CHANGELOG.md 작성 | v1.6.0 릴리즈 노트 (승인 워크플로우 운영화) | Low |
| P4-T3 | PR 템플릿 작성 | 문서 변경 체크리스트, 운영 준비 체크리스트 | Low |

**완료 기준:**
- [ ] CLAUDE.md에 Issue #40 완료 표시
- [ ] CHANGELOG.md에 운영화 개선 내용 기록
- [ ] PR 리뷰어가 검증할 수 있는 체크리스트 제공

---

## Step 5: 위험 관리 계획

### High Risk Items

| Risk | Impact | Probability | Mitigation Strategy |
|------|--------|-------------|-------------------|
| 환경 변수 기본값 충돌 | High | Low | `.env.example`에 명시적 false 기본값, 문서에 권장값 제공 |
| 기존 배포 환경 영향 | Medium | Medium | 롤백 절차 3단계 문서화, Feature flag로 점진적 활성화 |
| CLI 호환성 문제 | Medium | Low | 환경 변수 미설정 시 기존 동작 유지 (false 기본값) |
| ✅ 승인 상태 API 경로 불일치 | ~~Medium~~ Low | ~~Medium~~ Low | ✅ Phase 2에서 완료: `/api/approvals/{id}/status` 엔드포인트 추가 (services/mcp-server/app.py:499) |

### Technical Challenges

1. **환경 변수 전파**: Docker Compose → 컨테이너 → Python 프로세스
   - **해결 방안**: `.env.example` 주석으로 명시, docker-compose.yml에서 환경 변수 전달 확인

2. **문서 일관성**: 3개 문서에 동일 정보 중복
   - **해결 방안**: OPERATIONS_GUIDE.md를 마스터 문서로 지정, 다른 문서는 링크 참조

3. **로그 쿼리 성능**: SQLite에서 대량 승인 이력 조회 시 느려질 가능성
   - **해결 방안**: 인덱스 확인 (`approval_requests` 테이블), LIMIT 절 사용 권장

### Rollback Plan

**시나리오 1: 환경 변수 문제 발생**
```bash
# 1. 환경 변수 비활성화
echo "APPROVAL_WORKFLOW_ENABLED=false" >> .env
docker compose -f docker/compose.p3.yml restart mcp-server

# 2. 서비스 정상화 확인
curl http://localhost:8020/health

# 3. 로그 확인
docker logs mcp-server --tail 50
```

**시나리오 2: CLI 호환성 문제**
```bash
# 1. 이전 버전 scripts/ai.py로 복원
git checkout HEAD~1 -- scripts/ai.py

# 2. 승인 워크플로우 서버 측만 유지
# (API 엔드포인트는 영향 없음)
```

**시나리오 3: 문서 오류 발견**
```bash
# 1. PR에서 문서만 수정 후 재배포
# (코드 변경 없으므로 재시작 불필요)

# 2. 운영팀에 업데이트 공지
```

---

## Step 6: 리소스 요구사항

### Human Resources
- **개발자**: 1명 (백엔드/DevOps 경험)
- **리뷰어**: 1명 (보안/운영 전문가)
- **QA**: 운영팀 1명 (문서 검토)

### Technical Resources
- **개발 도구**: VSCode, Python 3.10+, Docker Compose
- **테스트 환경**: Phase 3 MCP 서버 (localhost:8020)
- **모니터링**: Docker logs, SQLite CLI

### Time Estimation
- **총 예상 시간**: 약 1.6일 (13시간)
  - Phase 1: 4시간 (문서화)
  - Phase 2: 3시간 (CLI/서버 정합)
  - Phase 3: 2시간 (검증)
  - Phase 4: 1시간 (배포 준비)
  - 버퍼: 3시간 (25%)
- **완료 목표일**: 2025-10-26 (금요일)

---

## Step 7: 품질 보증 계획

### Test Strategy

**레벨별 테스트:**
- **Unit Tests**: 불필요 (문서 중심 개선)
- **Integration Tests**: CLI E2E 수동 테스트 2개 시나리오
- **E2E Tests**: 승인 전체 플로우 시뮬레이션 (요청 → 승인 → 실행)

### Test Cases

```gherkin
Feature: 승인 워크플로우 환경 변수 제어

  Scenario: 승인 워크플로우 활성화 시 정상 동작
    Given APPROVAL_WORKFLOW_ENABLED=true
    When 사용자가 HIGH 도구 execute_python 호출
    Then 403 응답과 approval_required 메타데이터 수신
    And Rich 진행률 바로 승인 대기 시작
    And 관리자 승인 시 도구 자동 재실행

  Scenario: 승인 워크플로우 비활성화 시 스킵
    Given APPROVAL_WORKFLOW_ENABLED=false
    When 사용자가 HIGH 도구 execute_python 호출
    Then 403 응답과 안내 메시지 출력
    And 승인 폴링 시작하지 않음
    And 프로그램 종료

  Scenario: 환경 변수 미설정 시 기본값 사용
    Given APPROVAL_WORKFLOW_ENABLED 환경 변수 없음
    When 사용자가 HIGH 도구 execute_python 호출
    Then 기본값 false로 동작 (승인 스킵)
```

### Performance Criteria

승인 워크플로우는 대기 시간이 주요 메트릭이므로 성능 기준 완화:
- **응답시간**: 승인 대기 시 폴링 간격 1초 유지
- **처리량**: 동시 승인 요청 50개까지 지원 (APPROVAL_MAX_PENDING)
- **리소스 사용률**: CPU/메모리 영향 없음 (비동기 폴링)

---

## Step 8: 커뮤니케이션 계획

### Status Updates
- **일일 스탠드업**: Phase별 진행상황 공유 (Slack)
- **이슈 댓글 업데이트**: Phase 완료 시마다 체크리스트 업데이트
- **문서 초안 공유**: Phase 1 완료 후 운영팀 리뷰 요청

### Stakeholder Notification
- **운영팀**: 배포 1일 전 문서 공유, 롤백 절차 교육
- **개발팀**: PR 머지 전 코드 리뷰 요청
- **사용자**: CHANGELOG.md로 변경 사항 안내 (승인 워크플로우 활성화 방법)

---

## 📋 사용자 검토 체크리스트

### Planning Review
- [x] **이슈 분석이 정확한가요?**
  - 핵심 요구사항 4개 (문서, CLI, 서버, 운영) 모두 식별
  - Issue #26 완료 상태 정확히 파악 (API 3개, CLI 통합 완료)

- [x] **선택한 해결 방안이 적절한가요?**
  - Option 1 (최소 운영 준비) 권장: 빠른 배포 + 낮은 위험
  - 배치 승인은 실제 운영 경험 후 필요성 검증 (실용적 접근)

- [x] **구현 계획이 현실적인가요?**
  - Phase 1 (문서 4시간) → Phase 2 (CLI/서버 정합 3시간) → Phase 3 (검증 2시간) → Phase 4 (배포 1시간)
  - 총 13시간, 버퍼 25% 포함

### Resource Review
- [x] **시간 추정이 합리적인가요?**
  - 문서 작성 4시간 (OPERATIONS_GUIDE 신규 작성 포함)
  - 상태 API 정비 + CLI 환경 변수 체크 3시간 (엔드포인트 노출, 경로 설정, 테스트)
  - 버퍼 3시간 (25%) 확보

- [x] **필요한 리소스가 확보 가능한가요?**
  - 개발자 1명, 리뷰어 1명 (보안 전문가), 운영팀 1명 (문서 검토)
  - Phase 3 MCP 서버 환경 필요 (이미 구축됨)

### Risk Review
- [x] **위험 요소가 충분히 식별되었나요?**
  - 환경 변수 기본값 충돌 (High Impact, Low Probability)
  - 기존 배포 환경 영향 (Medium Impact, Medium Probability)
  - 롤백 시나리오 3개 문서화

- [x] **롤백 계획이 현실적인가요?**
  - 환경 변수 비활성화 → 서비스 재시작 (30초)
  - CLI 복원 → git checkout (10초)
  - 문서 수정 → PR 재배포 (재시작 불필요)

### Quality Review
- [x] **테스트 전략이 충분한가요?**
  - CLI E2E 수동 테스트 2개 시나리오
  - 승인 전체 플로우 시뮬레이션
  - 로그 조회 쿼리 5개로 이력 추적 검증

---

## ✅ Phase 3: 검증 및 테스트 (2025-10-24)

### 검증 계획

**3가지 시나리오 E2E 테스트:**

#### Scenario 1: 승인 워크플로우 활성화 (APPROVAL_WORKFLOW_ENABLED=true)
```bash
# 테스트 명령
export APPROVAL_WORKFLOW_ENABLED=true
python scripts/ai.py --mcp execute_python --mcp-args '{"code": "print(\"test\")"}'

# 예상 결과
# 1. ✅ 403 응답 + approval_required 메타데이터
# 2. ✅ request_id 수신
# 3. ✅ Rich 진행률 바 표시
# 4. ✅ 1초 간격으로 상태 API 폴링 시작 (GET /api/approvals/{id}/status)
# 5. ✅ 관리자 승인 시 도구 자동 재실행 또는 rejection 처리

# 검증 항목
- [ ] 승인 대기 메시지 표시 (Rich UI)
- [ ] 상태 API 200 OK 응답 (timeout detection 포함)
- [ ] 폴링 간격 1초 확인
- [ ] 승인 후 도구 재실행 또는 거부 메시지
```

#### Scenario 2: 승인 워크플로우 비활성화 (APPROVAL_WORKFLOW_ENABLED=false)
```bash
# 테스트 명령
export APPROVAL_WORKFLOW_ENABLED=false
python scripts/ai.py --mcp execute_python --mcp-args '{"code": "print(\"test\")"}'

# 예상 결과
# 1. ✅ 403 응답 (approval_required 메타데이터 포함)
# 2. ✅ 사용자 친화적 가이드 메시지 출력
# 3. ✅ 승인 폴링 시작하지 않음
# 4. ✅ 프로그램 정상 종료

# 검증 항목
- [ ] "Tool requires administrator approval" 메시지 표시
- [ ] "Set APPROVAL_WORKFLOW_ENABLED=true" 가이드 제공
- [ ] 상태 API 호출하지 않음 (Rich UI 표시 안 함)
- [ ] 에러 코드 정상 종료
```

#### Scenario 3: 환경 변수 미설정 (기본값 = false)
```bash
# 테스트 명령
unset APPROVAL_WORKFLOW_ENABLED
python scripts/ai.py --mcp execute_python --mcp-args '{"code": "print(\"test\")"}'

# 예상 결과
# Scenario 2와 동일 (기본값 false로 동작)

# 검증 항목
- [ ] Scenario 2와 동일한 가이드 메시지
- [ ] 환경 변수 미설정 시 기본값 적용 확인
```

### 테스트 검증 체크리스트

**코드 레벨 검증:**
- [ ] `services/mcp-server/app.py:499` `/api/approvals/{id}/status` 엔드포인트 동작 확인
  ```bash
  curl http://localhost:8020/api/approvals/test-id/status
  # 예상: {"status": "not_found", ...} JSON 응답
  ```

- [ ] `scripts/ai.py:180` `APPROVAL_WORKFLOW_ENABLED` 환경 변수 체크 동작 확인
  ```bash
  grep -A 5 "approval_enabled = os.getenv" scripts/ai.py
  ```

- [ ] `scripts/ai.py:1154` `--approvals` 명령 동작 확인
  ```bash
  python scripts/ai.py --approvals
  # 예상: 사용자의 대기 중인 승인 요청 목록
  ```

**데이터베이스 검증:**
- [ ] approval_requests 테이블 상태 확인
  ```bash
  sqlite3 /mnt/e/ai-data/sqlite/security.db \
    "SELECT COUNT(*) FROM approval_requests WHERE status='pending';"
  ```

**실패 시 진단:**
- [ ] 404 오류 발생: `app.py:499` 엔드포인트 재확인 및 MCP 서버 재시작
- [ ] 폴링 실패: 상태 API 응답 형식 확인 (JSON 구조)
- [ ] 타임아웃: `APPROVAL_TIMEOUT` 환경 변수 값 확인

### 테스트 결과 (진행 중)

**상태**: ⏳ Phase 3 테스트 준비 완료

**예상 실행 일시**: 2025-10-24 이후 (실제 MCP 서버 환경 필요)

**테스트 로그 경로**: 이 섹션 하단에 결과 추가 예정

```
[테스트 실행 후 결과를 여기에 기록]
- Scenario 1 (활성화): ⏳ 대기
- Scenario 2 (비활성화): ⏳ 대기
- Scenario 3 (미설정): ⏳ 대기

[이슈 발생 시]
- 이슈명: [해결 방안]
```

---

## 🚀 최종 단계 (Phase 4 완료)

**커밋 상태:**
- ✅ 6469c72: Phase 1-2 구현 완료 및 커밋
- ✅ CLAUDE.md 업데이트 (Issue #40 반영)
- ✅ CHANGELOG.md 작성 (v1.6.0 릴리즈 노트)

**남은 작업:**
1. Phase 3 검증 실행 및 결과 기록
2. 최종 PR 생성
   ```bash
   gh pr create --title "feat: operationalize approval workflow (Issue #40)" \
     --body "Closes #40

   ## Summary
   - Approval workflow documentation (배포, 운영, 롤백)
   - CLI status polling API (/api/approvals/{id}/status)
   - Environment variable control (APPROVAL_WORKFLOW_ENABLED)
   - User approval request listing (ai --approvals)

   ## Validation
   - Phase 1-2: ✅ 구현 완료 및 커밋
   - Phase 3: ⏳ E2E 테스트 진행 중
   - Phase 4: ✅ 문서 및 릴리즈 노트 작성 완료"
   ```

---

---

## 💡 피드백 요청

**다음 사항을 확인해주세요:**

1. **Option 1 (최소 운영 준비)** 선택에 동의하시나요?
   - 배치 승인 API는 실제 운영 경험 후 추가
   - Prometheus 메트릭은 Issue #20과 통합

2. **약 1.6일 일정**이 적절한가요?
   - Phase 1 (문서 4시간) 예상이 충분한가요?
   - Phase 2 (CLI/서버 정합 3시간)에 추가 기능이 필요한가요?

3. **문서 구조**에 수정이 필요한가요?
   - OPERATIONS_GUIDE.md를 마스터 문서로 지정
   - 다른 문서는 링크 참조 방식

4. **테스트 범위**가 충분한가요?
   - CLI E2E 수동 테스트 2개 시나리오
   - Pytest는 생략 (문서 중심 개선)

---

## 📊 요약

**핵심 결정사항:**
- ✅ **Option 1 (최소 운영 준비)** 권장: 문서화 강화 + CLI 환경 변수 처리
- ✅ **예상 일정**: 약 1.6일 → **✅ 구현 완료** (Phase 1-2 및 문서 작성 완료)
- ✅ **위험도**: Low (코드 변경 최소, 기존 기능 99% 유지)

**완료된 주요 작업:**
1. ✅ **문서 4개** 작성/개선 완료 (OPERATIONS_GUIDE 신규, IMPLEMENTATION_SUMMARY 확장, APPROVAL_GUIDE 확장, .env.example 주석 개선)
2. ✅ **승인 상태 API/CLI 정합**: `/api/approvals/{id}/status` 엔드포인트 노출 및 환경 변수 체크 로직 추가 완료
3. ⏳ **E2E 테스트** 2개 시나리오 수동 검증 (Phase 3, 진행 예정)

**2차 개선 후보** (별도 이슈):
- 배치 승인 API (`POST /api/approvals/batch`)
- Prometheus 메트릭 (`approval_requests_total`, `approval_latency_seconds`)
- 승인 대시보드 (Grafana 통합)
