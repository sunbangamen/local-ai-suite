==================================================
RBAC Deployment Verification Script
==================================================

Step 1: Checking environment variables...

[0;32mâœ“[0m .env file loaded
  RBAC_ENABLED=true
  SECURITY_DB_PATH=/mnt/e/ai-data/sqlite/security.db
  SANDBOX_ENABLED=true

Step 2: Initializing security database...

â„¹ Using existing database (SKIP_DB_RESET=true)

Step 3: Verifying database contents...

[1;33mâš [0m sqlite3 not found, skipping database verification
Step 4: Checking MCP server health...

[0;32mâœ“[0m MCP server is running at http://localhost:8020

Step 5: Running permission tests...

â„¹ Test 1: Guest user â†’ execute_python (expect 403)
[0;32mâœ“[0m Guest denied execute_python (403)
â„¹ Test 2: Developer user â†’ execute_python (expect NOT 403)
[0;32mâœ“[0m Developer allowed execute_python (200)
â„¹ Test 3: Guest user â†’ read_file (expect NOT 403)
[0;32mâœ“[0m Guest allowed read_file (200)
â„¹ Test 4: Developer user â†’ git_commit (expect 403)
[0;32mâœ“[0m Developer denied git_commit (403)

Step 6: Checking audit logs...

[1;33mâš [0m sqlite3 not found, skipping audit log verification
Step 7: Testing backup functionality...

â„¹ Running backup script...
Checkpointing WAL...
Copying database: /mnt/e/ai-data/sqlite/security.db -> /tmp/rbac_test_backup/security_backup_20251001_111827.db

Backup completed:
  Backup file: /tmp/rbac_test_backup/security_backup_20251001_111827.db
  Database size: 0.16 MB
  WAL size: 0.0 MB
  Integrity check: PASSED

âœ… Backup successful: /tmp/rbac_test_backup/security_backup_20251001_111827.db
[0;32mâœ“[0m Backup completed successfully
total 324K
-rw-r--r-- 1 root root 160K Oct  1 11:12 security_backup_20251001_111259.db
-rw-r--r-- 1 root root 164K Oct  1 11:18 security_backup_20251001_111827.db

Step 8: Performance benchmark...

â„¹ Running 10 permission checks...
  Total time: 75ms
  Average per request: 7ms
[0;32mâœ“[0m Performance acceptable (avg 7ms < 500ms)

==================================================
Verification Summary
==================================================

[0;32mâœ“[0m âœ“ Environment configured
[0;32mâœ“[0m âœ“ Database initialized
[0;32mâœ“[0m âœ“ MCP server running
[0;32mâœ“[0m âœ“ Permission tests passed
[0;32mâœ“[0m âœ“ Audit logging working
[0;32mâœ“[0m âœ“ Backup functional

Next steps:
  1. Review audit logs: sqlite3 /mnt/e/ai-data/sqlite/security.db 'SELECT * FROM security_audit_logs;'
  2. Monitor performance: Check Prometheus metrics at http://localhost:8020/metrics
  3. Test in production: Set RBAC_ENABLED=true in .env and restart services

Documentation:
  - Architecture: docs/security/architecture.md
  - Implementation: docs/security/IMPLEMENTATION_SUMMARY.md
  - ADR: docs/adr/adr-001-sqlite-vs-postgresql.md

[0;32mâœ“[0m Verification complete!
